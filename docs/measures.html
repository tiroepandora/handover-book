<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Measures – Handover Student Assistent</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tabular_editor.html" rel="next">
<link href="./dashboards.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-562adc6a6ba6d3f803331ca446c74a20.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./measures.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Measures</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Handover Student Assistent</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./operational_tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Operational Tasks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dashboards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dashboards</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./measures.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Measures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tabular_editor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tabular Editor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./google_cloud_platforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Google Cloud Platform (GCP)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project_ideas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Project Ideas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./useful_links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Useful Links</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">HR</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#brandinterest-category-interest-in-bigquery-and-powerbi" id="toc-brandinterest-category-interest-in-bigquery-and-powerbi" class="nav-link active" data-scroll-target="#brandinterest-category-interest-in-bigquery-and-powerbi"><span class="header-section-number">4.1</span> BrandInterest &amp; Category Interest in BigQuery and PowerBI</a>
  <ul class="collapse">
  <li><a href="#brandinterest-in-bigquery" id="toc-brandinterest-in-bigquery" class="nav-link" data-scroll-target="#brandinterest-in-bigquery"><span class="header-section-number">4.1.1</span> BrandInterest in BigQuery</a></li>
  </ul></li>
  <li><a href="#customer-acquisition" id="toc-customer-acquisition" class="nav-link" data-scroll-target="#customer-acquisition"><span class="header-section-number">4.2</span> Customer Acquisition</a>
  <ul class="collapse">
  <li><a href="#how-the-ca_month_yoy_simplified-measure-works" id="toc-how-the-ca_month_yoy_simplified-measure-works" class="nav-link" data-scroll-target="#how-the-ca_month_yoy_simplified-measure-works"><span class="header-section-number">4.2.1</span> How the “CA_Month_YOY_Simplified” Measure Works</a></li>
  </ul></li>
  <li><a href="#total-spend-calculated-column" id="toc-total-spend-calculated-column" class="nav-link" data-scroll-target="#total-spend-calculated-column"><span class="header-section-number">4.3</span> Total Spend Calculated Column</a></li>
  <li><a href="#the-index-logic-to-allow-for-dynamic-year-changes" id="toc-the-index-logic-to-allow-for-dynamic-year-changes" class="nav-link" data-scroll-target="#the-index-logic-to-allow-for-dynamic-year-changes"><span class="header-section-number">4.4</span> The Index Logic to allow for dynamic year changes</a>
  <ul class="collapse">
  <li><a href="#why-use-an-index" id="toc-why-use-an-index" class="nav-link" data-scroll-target="#why-use-an-index"><span class="header-section-number">4.4.1</span> Why Use an Index?</a></li>
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works"><span class="header-section-number">4.4.2</span> How It Works</a></li>
  </ul></li>
  <li><a href="#integrating-asana-into-power-bi" id="toc-integrating-asana-into-power-bi" class="nav-link" data-scroll-target="#integrating-asana-into-power-bi"><span class="header-section-number">4.5</span> Integrating Asana into Power BI</a>
  <ul class="collapse">
  <li><a href="#how-to-connect-asana-as-a-data-source" id="toc-how-to-connect-asana-as-a-data-source" class="nav-link" data-scroll-target="#how-to-connect-asana-as-a-data-source"><span class="header-section-number">4.5.1</span> How to Connect Asana as a Data Source</a></li>
  <li><a href="#managing-tasks-for-power-bi-dashboards" id="toc-managing-tasks-for-power-bi-dashboards" class="nav-link" data-scroll-target="#managing-tasks-for-power-bi-dashboards"><span class="header-section-number">4.5.2</span> Managing Tasks for Power BI Dashboards</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Measures</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This section outlines some some features i have created and it is useful to have some documentation for them.</p>
<section id="brandinterest-category-interest-in-bigquery-and-powerbi" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="brandinterest-category-interest-in-bigquery-and-powerbi"><span class="header-section-number">4.1</span> BrandInterest &amp; Category Interest in BigQuery and PowerBI</h2>
<p>To enhance performance and reliability, both BrandInterest and Category Interest calculations are now performed in BigQuery.</p>
<section id="brandinterest-in-bigquery" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="brandinterest-in-bigquery"><span class="header-section-number">4.1.1</span> BrandInterest in BigQuery</h3>
<p>There are two main views for BrandInterest in BigQuery:</p>
<ul>
<li><strong>BrandInterestAGG</strong>: The primary view containing all key metrics for all markets across the full date range.</li>
<li><strong>BrandInterestAGG_2</strong>: A fallback view that always contains the latest complete week for each market (one row per market). This ensures that if a user selects a week with incomplete data, the dashboard will automatically display the latest available complete week for each market. If the selected week has complete data, the dashboard will show that week as expected. This approach avoids complex workarounds or heavy computations in PowerBI and ensures users always see the most relevant and complete data.</li>
</ul>
<p>The same approach is applied to CategoryInterest data.</p>
<ul>
<li><a href="https://console.cloud.google.com/bigquery?project=pandora-dashboard-data&amp;ws=!1m5!1m4!4m3!1spandora-dashboard-data!2sgoogle_offline_data!3sBrandInterestAGG&amp;pli=1&amp;inv=1&amp;invt=Ab09Vg">BrandInterestAGG View</a></li>
<li><a href="https://console.cloud.google.com/bigquery?project=pandora-dashboard-data&amp;ws=!1m10!1m4!4m3!1spandora-dashboard-data!2sgoogle_offline_data!3sBrandInterestAGG!1m4!4m3!1spandora-dashboard-data!2sgoogle_offline_data!3sBrandInterestAGG_2&amp;pli=1&amp;inv=1&amp;invt=Ab09Vg&amp;chat=true">BrandInterestAGG_2 View</a></li>
<li><a href="https://console.cloud.google.com/bigquery?project=pandora-dashboard-data&amp;ws=!1m10!1m4!4m3!1spandora-dashboard-data!2sgoogle_offline_data!3sCategoryInterestAGG&amp;pli=1&amp;inv=1&amp;invt=Ab09Vg&amp;chat=true">CategoryInterestAGG View</a></li>
<li><a href="https://console.cloud.google.com/bigquery?project=pandora-dashboard-data&amp;ws=!1m10!1m4!4m3!1spandora-dashboard-data!2sgoogle_offline_data!3sBrandInterestAGG!1m4!4m3!1spandora-dashboard-data!2sgoogle_offline_data!3sCategoryInterestAGG_2&amp;pli=1&amp;inv=1&amp;invt=Ab09Vg&amp;chat=true">CategoryInterestAGG_2 View</a></li>
</ul>
<p>These views are connected to PowerBI, allowing you to use simple measures directly in your visuals. The tables are linked to the master dates table using <code>Week_ForForFive</code> and to the market dimension using the market key.</p>
<p>Below is the SQL query for the <strong>BrandInterestAGG</strong> view, with explanations:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 1: Aggregate weekly data per country and map country names to market codes</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> Aggregated <span class="kw">AS</span> (</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        b.country,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- Map country names to 2-letter market codes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">CASE</span> b.country </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="st">'Australia'</span> <span class="cf">THEN</span> <span class="st">'AU'</span> <span class="cf">WHEN</span> <span class="st">'Canada'</span> <span class="cf">THEN</span> <span class="st">'CA'</span> <span class="cf">WHEN</span> <span class="st">'Germany'</span> <span class="cf">THEN</span> <span class="st">'DE'</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="st">'Spain'</span> <span class="cf">THEN</span> <span class="st">'ES'</span> <span class="cf">WHEN</span> <span class="st">'France'</span> <span class="cf">THEN</span> <span class="st">'FR'</span> <span class="cf">WHEN</span> <span class="st">'Italy'</span> <span class="cf">THEN</span> <span class="st">'IT'</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="st">'Poland'</span> <span class="cf">THEN</span> <span class="st">'PL'</span> <span class="cf">WHEN</span> <span class="st">'United Kingdom'</span> <span class="cf">THEN</span> <span class="st">'UK'</span> <span class="cf">WHEN</span> <span class="st">'United States'</span> <span class="cf">THEN</span> <span class="st">'US'</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="st">'China'</span> <span class="cf">THEN</span> <span class="st">'CN'</span> <span class="cf">WHEN</span> <span class="st">'Mexico'</span> <span class="cf">THEN</span> <span class="st">'MX'</span> <span class="cf">ELSE</span> <span class="st">'N/A'</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span> <span class="kw">AS</span> Market,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MIN</span>(b.<span class="dt">date</span>) <span class="kw">AS</span> FirstDayOfTheWeek, <span class="co">-- Get the earliest date for the week</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">CAST</span>(m.Week_ForForFive <span class="kw">AS</span> INT64) <span class="kw">AS</span> Week_ForForFive, <span class="co">-- Week identifier</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(b.queries) <span class="kw">AS</span> Sum_BI, <span class="co">-- Average branded queries for the week</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MAX</span>(m.WeekDay) <span class="kw">AS</span> Max_WeekDay, <span class="co">-- Last day of the week</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(b.queries <span class="op">/</span> b.total_searches) <span class="kw">AS</span> avg_share_of_searches <span class="co">-- Average share of branded queries</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> `pandora<span class="op">-</span>dashboard<span class="op">-</span><span class="kw">data</span>.google_offline_data.branded_searches_backfill` b</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span> `pandora<span class="op">-</span>dashboard<span class="op">-</span><span class="kw">data</span>.Master_Date_Table.master_dates` m</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ON</span> b.<span class="dt">date</span> <span class="op">=</span> PARSE_DATE(<span class="st">'%Y-%m-%d'</span>, m.DW_TS_From) <span class="co">-- Join on date</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> b.Brand <span class="op">=</span> <span class="ot">"Pandora"</span> <span class="co">-- Filter for Pandora brand</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> b.country, m.Week_ForForFive</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 2: Calculate rolling averages for the current year (CY)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>CY <span class="kw">AS</span> (</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        Market, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        Week_ForForFive, </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        Week_ForForFive <span class="op">-</span> <span class="dv">100</span> <span class="kw">AS</span> Week_ForForFive_LY, <span class="co">-- Calculate last year's week</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        Max_WeekDay, </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        FirstDayOfTheWeek, </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        Sum_BI, </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        avg_share_of_searches,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- 4-week rolling average of Sum_BI (current and next 3 weeks)</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(Sum_BI) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> Market <span class="kw">ORDER</span> <span class="kw">BY</span> Week_ForForFive <span class="kw">DESC</span> <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span> <span class="kw">AND</span> <span class="dv">3</span> <span class="kw">FOLLOWING</span>) <span class="kw">AS</span> Four_Week_Avg_CY,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- 4-week rolling average of avg_share_of_searches</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(avg_share_of_searches) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> Market <span class="kw">ORDER</span> <span class="kw">BY</span> Week_ForForFive <span class="kw">DESC</span> <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span> <span class="kw">AND</span> <span class="dv">3</span> <span class="kw">FOLLOWING</span>) <span class="kw">AS</span> Four_Week_Avg_Share_CY,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- 12-week rolling average of Sum_BI</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(Sum_BI) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> Market <span class="kw">ORDER</span> <span class="kw">BY</span> Week_ForForFive <span class="kw">DESC</span> <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span> <span class="kw">AND</span> <span class="dv">11</span> <span class="kw">FOLLOWING</span>) <span class="kw">AS</span> Twelve_Week_Avg_CY</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> Aggregated</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 3: Calculate rolling averages for the last year (LY)</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>LY <span class="kw">AS</span> (</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        Market, </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        Week_ForForFive, </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        Sum_BI, </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        avg_share_of_searches,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- 4-week rolling average for LY</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(Sum_BI) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> Market <span class="kw">ORDER</span> <span class="kw">BY</span> Week_ForForFive <span class="kw">DESC</span> <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span> <span class="kw">AND</span> <span class="dv">3</span> <span class="kw">FOLLOWING</span>) <span class="kw">AS</span> Four_Week_Avg_LY,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- 12-week rolling average for LY</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(Sum_BI) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> Market <span class="kw">ORDER</span> <span class="kw">BY</span> Week_ForForFive <span class="kw">DESC</span> <span class="kw">ROWS</span> <span class="kw">BETWEEN</span> <span class="kw">CURRENT</span> <span class="kw">ROW</span> <span class="kw">AND</span> <span class="dv">11</span> <span class="kw">FOLLOWING</span>) <span class="kw">AS</span> Twelve_Week_Avg_LY</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> Aggregated</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 4: Join CY and LY, calculate YOY metrics and lagged values</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    cy.Market, </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    cy.Week_ForForFive, </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    cy.Max_WeekDay, </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    FORMAT_DATE(<span class="st">'%Y%m%d'</span>, cy.FirstDayOfTheWeek) <span class="kw">AS</span> DateKey, <span class="co">-- Format date for reporting</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    cy.Sum_BI, </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    cy.avg_share_of_searches, </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    cy.Four_Week_Avg_CY, </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    cy.Four_Week_Avg_Share_CY, </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    cy.Twelve_Week_Avg_CY,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    ly.Four_Week_Avg_LY, </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    ly.Twelve_Week_Avg_LY, </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    ly.avg_share_of_searches <span class="kw">as</span> avg_share_of_searches_ly,</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Year-over-year (YOY) comparisons (as percentages)</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    (cy.Four_Week_Avg_CY <span class="op">/</span> <span class="fu">NULLIF</span>(ly.Four_Week_Avg_LY, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> Four_Week_YOY,</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    (cy.Twelve_Week_Avg_CY <span class="op">/</span> <span class="fu">NULLIF</span>(ly.Twelve_Week_Avg_LY, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> Twelve_Week_YOY,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    (cy.Sum_BI <span class="op">/</span> <span class="fu">NULLIF</span>(ly.Sum_BI, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> YOY,</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Lagged YOY values (next week’s YOY, for trend analysis)</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LEAD</span>((cy.Four_Week_Avg_CY <span class="op">/</span> <span class="fu">NULLIF</span>(ly.Four_Week_Avg_LY, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">100</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> cy.Market <span class="kw">ORDER</span> <span class="kw">BY</span> cy.Week_ForForFive <span class="kw">DESC</span>) <span class="kw">AS</span> Four_Week_YOY_lag,</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LEAD</span>((cy.Twelve_Week_Avg_CY <span class="op">/</span> <span class="fu">NULLIF</span>(ly.Twelve_Week_Avg_LY, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">100</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> cy.Market <span class="kw">ORDER</span> <span class="kw">BY</span> cy.Week_ForForFive <span class="kw">DESC</span>) <span class="kw">AS</span> Twelve_Week_YOY_lag,</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LEAD</span>((cy.Sum_BI <span class="op">/</span> <span class="fu">NULLIF</span>(ly.Sum_BI, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">100</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> cy.Market <span class="kw">ORDER</span> <span class="kw">BY</span> cy.Week_ForForFive <span class="kw">DESC</span>) <span class="kw">AS</span> YOY_lag,</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Lagged values for share of searches and rolling averages</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LEAD</span>(cy.avg_share_of_searches) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> cy.Market <span class="kw">ORDER</span> <span class="kw">BY</span> cy.Week_ForForFive <span class="kw">DESC</span>) <span class="kw">AS</span> avg_share_of_searches_CY_lag,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LEAD</span>(ly.avg_share_of_searches) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> cy.Market <span class="kw">ORDER</span> <span class="kw">BY</span> cy.Week_ForForFive <span class="kw">DESC</span>) <span class="kw">AS</span> avg_share_of_searches_LY_lag,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LEAD</span>(cy.Four_Week_Avg_Share_CY) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> cy.Market <span class="kw">ORDER</span> <span class="kw">BY</span> cy.Week_ForForFive <span class="kw">DESC</span>) <span class="kw">AS</span> Four_Week_Avg_Share_CY_lag</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> CY</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> LY </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> cy.Market <span class="op">=</span> ly.Market </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> cy.Week_ForForFive_LY <span class="op">=</span> ly.Week_ForForFive <span class="co">-- Join CY with LY by market and week</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> cy.Market <span class="kw">ASC</span>, cy.Week_ForForFive <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="customer-acquisition" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="customer-acquisition"><span class="header-section-number">4.2</span> Customer Acquisition</h2>
<p>With the integration of Customer Acquisition (CA) into the dashboards, several changes have been made. We now use monthly data for CA reporting.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>CA_Month_YoY_Simplified <span class="op">=</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>VAR CurrentYear <span class="op">=</span> [<span class="kw">Current</span> <span class="dt">Year</span> <span class="dt">Number</span> WA]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>VAR SelectedWeek <span class="op">=</span> SELECTEDVALUE(<span class="st">'Date'</span>[Week <span class="dt">Number</span> <span class="dt">int</span> <span class="dv">2</span>])</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 1: Get the MonthIndex for the selected week</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>VAR SelectedMonthIndex <span class="op">=</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    CALCULATE(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MAX</span>(<span class="st">'Date'</span>[YearMonth445]),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ALL</span>(<span class="st">'Date'</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Date'</span>[<span class="dt">Year</span>] <span class="op">=</span> CurrentYear,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Date'</span>[Week <span class="dt">Number</span> <span class="dt">int</span> <span class="dv">2</span>] <span class="op">=</span> SelectedWeek</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 2: Find latest populated MonthIndex from the fact table</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>VAR LatestMonthNr <span class="op">=</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>CALCULATE(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MAX</span>(<span class="st">'Customer_Acquisition_Monthly'</span>[MonthYR]),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    TOPN(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ALL</span>(<span class="st">'Customer_Acquisition_Monthly'</span>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Customer_Acquisition_Monthly'</span>[<span class="dt">Year</span>], <span class="kw">DESC</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Customer_Acquisition_Monthly'</span>[<span class="dt">Month</span> Nr], <span class="kw">DESC</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 3: Determine which month to use based on the simplified logic</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>VAR UseMonth <span class="op">=</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span>(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        SelectedMonthIndex <span class="op">&lt;=</span> LatestMonthNr <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        SelectedMonthIndex <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        LatestMonthNr</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 5: Get values for CY and LY</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>VAR CY_Value <span class="op">=</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    CALCULATE(</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SUM</span>(Customer_Acquisition_Monthly[NbrCustomers]),</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        Customer_Acquisition_Monthly[MonthYR] <span class="op">=</span> UseMonth</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>VAR LY_Value <span class="op">=</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    CALCULATE(</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SUM</span>(Customer_Acquisition_Monthly[NbrCustomers]),</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        Customer_Acquisition_Monthly[MonthYR] <span class="op">=</span> UseMonth <span class="op">-</span> <span class="dv">100</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 6: Return YoY %</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="kw">RETURN</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    DIVIDE(CY_Value <span class="op">*</span> <span class="dv">100</span>, LY_Value, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="how-the-ca_month_yoy_simplified-measure-works" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="how-the-ca_month_yoy_simplified-measure-works"><span class="header-section-number">4.2.1</span> How the “CA_Month_YOY_Simplified” Measure Works</h3>
<p>The measure “CA_Month_YOY_Simplified” calculates the Year-over-Year (YoY) change in customer acquisition for a selected week. It determines the relevant month based on the selected week and the latest available data, then compares the number of customers acquired in that month for the current year and the previous year.</p>
<section id="step-by-step-logic" class="level4" data-number="4.2.1.1">
<h4 data-number="4.2.1.1" class="anchored" data-anchor-id="step-by-step-logic"><span class="header-section-number">4.2.1.1</span> Step-by-Step Logic</h4>
<ol type="1">
<li><p><strong>Determine the Month for the Selected Week</strong><br>
The measure identifies which month (using the <code>YearMonth445</code> field) the selected week falls into.</p></li>
<li><p><strong>Find the Latest Populated Month in the Fact Table</strong><br>
It checks the fact table to find the most recent month (<code>MonthYR</code>) for which customer acquisition data is available (typically the last two months).</p></li>
<li><p><strong>Decide Which Month to Use for Reporting</strong><br>
The measure applies the following logic:</p>
<ul>
<li>If the selected month index is less than or equal to the latest available month index plus one, use the selected month (or the previous month if the selected week is ahead by one).</li>
<li>If the selected month index is greater than the latest available month index plus one, use the latest available month with data.</li>
</ul></li>
</ol>
<p>This ensures the measure always uses the most relevant and available month for calculations, even if the selected week is ahead of the latest data.</p>
</section>
<section id="example-scenarios" class="level4" data-number="4.2.1.2">
<h4 data-number="4.2.1.2" class="anchored" data-anchor-id="example-scenarios"><span class="header-section-number">4.2.1.2</span> Example Scenarios</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 23%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Scenario</th>
<th style="text-align: center;">Selected Month Index</th>
<th style="text-align: center;">Latest Data Month Index</th>
<th style="text-align: left;">Logic Applied</th>
<th style="text-align: center;">Month Used for CA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1. User selects 3rd week of July, latest data is June</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">6</td>
<td style="text-align: left;">7 ≤ 6 + 1 → Use previous month: 7 - 1 = 6</td>
<td style="text-align: center;">June</td>
</tr>
<tr class="even">
<td style="text-align: left;">2. User selects a week in August, latest data is June</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">6</td>
<td style="text-align: left;">8 ≤ 6 + 1 → False, use latest available month</td>
<td style="text-align: center;">June</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3. User selects 2nd week of February, latest data is June</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">6</td>
<td style="text-align: left;">2 ≤ 6 + 1 → True, use selected month</td>
<td style="text-align: center;">February</td>
</tr>
</tbody>
</table>
<p>This logic ensures that:</p>
<ul>
<li>If the user selects a week in a month for which data is not yet available, the measure defaults to the latest available month.</li>
<li>If the user selects a week in a month for which data is available, the measure uses that month.</li>
<li>If the user selects a week in a past month (for which data is available), the measure uses the selected month.</li>
</ul>
<p>This approach guarantees that customer acquisition reporting is always accurate and up-to-date, reflecting the most relevant data available.</p>
</section>
</section>
</section>
<section id="total-spend-calculated-column" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="total-spend-calculated-column"><span class="header-section-number">4.3</span> Total Spend Calculated Column</h2>
<p>The Total Spend calculated column is used in both dashboards (ATR and WMP). It displays either the actual or planned spend for each row, or 0, depending on the context—specifically, whether actual or planned spend should be shown. This is necessary because the GMT table contains both planned and actual spend values in the same table.</p>
<p>Using a calculated column instead of a measure provides greater consistency and flexibility: the result is always the same for each row, regardless of any filters applied in visuals. In contrast, a measure could change its value depending on the filters, which may not be desirable for reporting purposes.</p>
</section>
<section id="the-index-logic-to-allow-for-dynamic-year-changes" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="the-index-logic-to-allow-for-dynamic-year-changes"><span class="header-section-number">4.4</span> The Index Logic to allow for dynamic year changes</h2>
<p>To support dynamic year changes and accurate time-based calculations, we have implemented an index logic in the master date table. Each unique combination of week and year is assigned a sequential index (e.g., <code>WeekIndex</code>). This index is referenced in measures and calculations, enabling dashboards to seamlessly handle week-over-week or year-over-year comparisons—even when weeks span across different years.</p>
<section id="why-use-an-index" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="why-use-an-index"><span class="header-section-number">4.4.1</span> Why Use an Index?</h3>
<p>When calculating rolling averages (such as 4-week or 12-week averages), simply subtracting a fixed number from the selected week number does not work if the calculation crosses a year boundary. The index solves this by providing a continuous sequence across years.</p>
</section>
<section id="how-it-works" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="how-it-works"><span class="header-section-number">4.4.2</span> How It Works</h3>
<ul>
<li>The master date table contains a column (e.g., <code>WeekIndex</code>) that uniquely identifies each week, incrementing across years.</li>
<li>Measures use the selected week’s index to determine the correct range for calculations.</li>
<li>For example, to calculate a 4-week average, the measure filters data where <code>WeekIndex</code> is between the selected index and (selected index - 3), regardless of year.</li>
</ul>
<p>This approach ensures that time-based calculations remain accurate and robust, even as users select weeks from different years.</p>
<p><strong>Example:</strong></p>
<p>Suppose a user selects the first week of a new year. The index logic allows the measure to include the last weeks of the previous year in rolling calculations, ensuring continuity and correctness.</p>
<p>This method is essential for scenarios where rolling averages or comparisons span multiple years, providing consistent and reliable results in your dashboards.</p>
</section>
</section>
<section id="integrating-asana-into-power-bi" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="integrating-asana-into-power-bi"><span class="header-section-number">4.5</span> Integrating Asana into Power BI</h2>
<p>You can connect Asana to Power BI to automatically import and visualize project tasks.</p>
<section id="how-to-connect-asana-as-a-data-source" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="how-to-connect-asana-as-a-data-source"><span class="header-section-number">4.5.1</span> How to Connect Asana as a Data Source</h3>
<ol type="1">
<li>In Power BI Desktop, click <strong>Home &gt; Get Data &gt; More…</strong>.</li>
<li>Search for “Asana” and select it as a data source.</li>
<li>Paste the link to the specific Asana project you want to connect to.</li>
<li>Follow the prompts to authenticate and load your data.</li>
</ol>
</section>
<section id="managing-tasks-for-power-bi-dashboards" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="managing-tasks-for-power-bi-dashboards"><span class="header-section-number">4.5.2</span> Managing Tasks for Power BI Dashboards</h3>
<ul>
<li>To include a new task in your dashboard, simply create it in Asana and apply the appropriate tag.</li>
<li>The following tags are used to categorize tasks:
<ul>
<li><code>Patch Notes ATR</code></li>
<li><code>Patch Notes WMP</code></li>
<li><code>Refresh</code></li>
</ul></li>
<li>Use the “Patch Notes” tags for patch note items and the “Refresh” tag for refresh-related tasks.</li>
</ul>
<p>The Power BI setup is configured to automatically fetch all tasks with these tags, ensuring your dashboards are always up to date with the latest relevant items from Asana.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./dashboards.html" class="pagination-link" aria-label="Dashboards">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dashboards</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./tabular_editor.html" class="pagination-link" aria-label="Tabular Editor">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tabular Editor</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>